# 百万级文本关键词聚合工具 - 项目开发指导书

## 1. 项目目标
开发一款面向非技术用户的 Windows 桌面软件（免费开源），用于处理百万级（2-5MB）长文本。
**核心功能**：
1. **智能搜索**：支持字符级、模糊匹配（如“玄天*”）、子串匹配。
2. **关键词聚合**：基于搜索结果，自动发现并聚合高频相关词（如搜“丹药”自动聚合出“玄天丹”、“九转金丹”）。

## 2. 技术架构选型
采用 **Electron + Python (前后端分离)** 架构。

| 模块 | 技术栈 | 说明 |
| :--- | :--- | :--- |
| **前端 (UI)** | **Electron + react + Vite** | 负责界面交互、文件拖拽、结果展示。 |
| **后端 (算法)** | **Python + FastAPI** | 负责核心 NLP 算法、文件读取、搜索计算。 |
| **通信** | **HTTP (REST API)** | 前端请求 `localhost` 接口，后端返回 JSON 数据。 |
| **打包** | **PyInstaller + Electron-Builder** | 将 Python 打包为独立 exe，内嵌至 Electron 应用中。 |

## 3. 核心算法实现方案

### 3.1 搜索引擎 (Whoosh)
- **功能**：处理模糊搜索和通配符查询。
- **实现**：
  - 使用 `Whoosh` 建立内存索引（Schema: `content=TEXT(stored=True)`）。
  - 支持 `*` (多字符) 和 `?` (单字符) 通配符。
  - **优势**：无需手写复杂的正则匹配逻辑，性能极高。

### 3.2 聚合引擎 (Jieba + Counter)
- **功能**：从搜索结果中提取高频聚合词。
- **逻辑**：
  1. **Hit Extraction**：获取所有包含搜索词的句子。
  2. **Candidate Generation**：对句子进行 `jieba.lcut_for_search()` 分词。
  3. **Filtering**：保留包含搜索词且长度 > 1 的词（如搜“丹”，保留“玄天丹”）。
  4. **Ranking**：使用 `collections.Counter` 统计词频，输出 Top N。

## 4. 开发路线图

### 第一阶段：Python 核心算法验证 (MVP)
1. 创建 `core.py`。
2. 实现 `load_text(path)`：读取 TXT 文件。
3. 实现 `search(keyword)`：返回包含关键词的句子列表。
4. 实现 `aggregate(keyword)`：返回 `[('玄天丹', 50), ('聚气丹', 12)]`。
5. **验证**：在命令行测试搜“丹”能否跑出“玄天丹”。

### 第二阶段：API 服务化
1. 引入 `FastAPI` 和 `Uvicorn`。
2. 封装接口：
   - `POST /upload`: 接收文件路径，触发索引构建。
   - `GET /search?q=...`: 返回搜索结果。
   - `GET /aggregate?q=...`: 返回聚合词云。
3. 使用 `PyInstaller -F api.py` 打包成 `api.exe` 并测试运行。

### 第三阶段：Electron 前端开发
1. 初始化 `electron-vite-vue` 项目。
2. **主进程 (`main.js`)**：
   - 启动时 `child_process.spawn('./resources/api.exe')`。
   - 退出时 `taskkill` 杀掉 Python 进程。
3. **渲染进程 (`App.vue`)**：
   - **左侧**：大文本阅读器（必须使用 `vue-virtual-scroller` 虚拟列表，否则百万字会卡死）。
   - **右侧**：搜索框 + 聚合标签云（点击标签可反向筛选）。

### 第四阶段：打包与发布
1. 配置 `electron-builder`：
   - 将 `api.exe` 配置到 `extraResources` 目录。
2. 构建安装包：`npm run build` -> 生成 `Setup.exe`。
3. **测试**：在没有 Python 环境的纯净 Windows 虚拟机中运行，确保功能正常。

## 5. 避坑指南
1. **端口冲突**：Python 服务启动时最好动态寻找可用端口，并通过 stdout 告诉 Electron，或者固定一个生僻端口（如 12345）。
2. **大文件渲染**：前端千万不要直接 `v-html` 渲染整个文本！一定要用虚拟滚动，只渲染可视区域。
3. **Jieba 词典**：如果小说中生造词太多（如“斗之气三段”），提供一个“添加自定义词”的功能，调用 `jieba.add_word()`。
